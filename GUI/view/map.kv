#:kivy 2.2.1
#:import Factory kivy.factory.Factory
#:import AddObjectPopup GUI.utils.add_object_popup.AddObjectPopup
#:import MDAddObjectDialogButton GUI.utils.add_object_popup.MDAddObjectDialogButton
#:import MultiSelectDropdown GUI.utils.multi_select_dropdown.MultiSelectDropdown

<AddObjectPopup>:
    id: add_object_popup
    auto_dismiss: False
    title: "Добавить объект на карту"
    size_hint: 0.5, 0.5
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height

        GridLayout:
            cols: 2
            Button:
                text: "Добавить"
                on_release: root.add_object()
            Button:
                text: "Отмена"
                on_release: root.dismiss()

<MultiSelectOption@ToggleButton>:
    size_hint: 1, None
    height: '48dp'

<MainScreen>:
    MDGridLayout:
        cols: 2

        MDBottomNavigation:
            selected_color_background: "orange"
            text_color_active: "lightgray"

            MDBottomNavigationItem:
                name: 'object_viewer_screen'
                text: 'Object Viewer'
                icon: 'map'
                
                MDLabel:
                    id: viewer_screen_label
                    text: 'Объект не выбран'
                    halign: 'center'

            MDBottomNavigationItem:
                name: 'debug_screen'
                text: 'Debug'
                icon: 'bug'

                BoxLayout:
                    orientation: "horizontal"

                    BoxLayout:
                        orientation: "vertical"

                        Button:
                            text: "Удалить все map_object"
                            on_release: root.ids.map_view.remove_map_objects()
                        Button:
                            text: "Взорвать приложение"
                            on_release: root.ids.map_view.blow_app()
                        Button:
                            text: "wanna see my ids?"
                            on_release: print(root.ids)
                        Button:
                            text: "+"
                            size_hint: 1, 1
                            on_release: Factory.AddObjectPopup().open(root.ids.map_view.tile_map)
                        MultiSelectDropdown:
                            id: map_layers_dropdown
                            values: root.ids.map_view.layers
                            dropdown_dismiss: root.ids.map_view.tile_map.draw_object_groups(root.ids.map_view.selected_layers)    

        Splitter:
            id: map_view_splitter
            sizable_from: "left"
            MDBoxLayout:
                orientation: "vertical"
                MDAddObjectDialogButton:
                    on_release: self.show_dialog()
                ScatterLayout:
                    do_rotation: False
                    do_translation: False
                    do_scale: False
                    StencilView:
                        MapView:
                            id: map_view
                            object_view_label_proxy: root.ids.viewer_screen_label
                            selected_layers: root.ids.map_layers_dropdown.selected_values

<MapView>:
    do_rotation: False
    on_touch_down: print(self.to_local(*args[1].pos), (self.size))
